<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Add custom annotation | ClusterGVis Reference Book</title>
  <meta name="description" content="This is a detailed documentation of ClusterGVis package." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Add custom annotation | ClusterGVis Reference Book" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a detailed documentation of ClusterGVis package." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Add custom annotation | ClusterGVis Reference Book" />
  
  <meta name="twitter:description" content="This is a detailed documentation of ClusterGVis package." />
  

<meta name="author" content="Jun Zhang" />


<meta name="date" content="2024-10-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="parse-preudotime-data.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ClusterGVis manual documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#citation"><i class="fa fa-check"></i><b>1.1</b> Citation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#bugs"><i class="fa fa-check"></i><b>1.3</b> Bugs</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basic-usage.html"><a href="basic-usage.html"><i class="fa fa-check"></i><b>2</b> Basic usage</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-usage.html"><a href="basic-usage.html#input-data"><i class="fa fa-check"></i><b>2.1</b> Input data</a></li>
<li class="chapter" data-level="2.2" data-path="basic-usage.html"><a href="basic-usage.html#clustering-for-expression-matrix"><i class="fa fa-check"></i><b>2.2</b> Clustering for expression matrix</a></li>
<li class="chapter" data-level="2.3" data-path="basic-usage.html"><a href="basic-usage.html#line-plot"><i class="fa fa-check"></i><b>2.3</b> Line plot</a></li>
<li class="chapter" data-level="2.4" data-path="basic-usage.html"><a href="basic-usage.html#heatmap-plot"><i class="fa fa-check"></i><b>2.4</b> Heatmap plot</a></li>
<li class="chapter" data-level="2.5" data-path="basic-usage.html"><a href="basic-usage.html#sample-group-and-order"><i class="fa fa-check"></i><b>2.5</b> Sample group and order</a></li>
<li class="chapter" data-level="2.6" data-path="basic-usage.html"><a href="basic-usage.html#multiple-sample-annotation"><i class="fa fa-check"></i><b>2.6</b> Multiple sample annotation</a></li>
<li class="chapter" data-level="2.7" data-path="basic-usage.html"><a href="basic-usage.html#and-line-trend-anntation"><i class="fa fa-check"></i><b>2.7</b> And line trend anntation</a></li>
<li class="chapter" data-level="2.8" data-path="basic-usage.html"><a href="basic-usage.html#multiple-group-line-plot"><i class="fa fa-check"></i><b>2.8</b> Multiple group line plot</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html"><i class="fa fa-check"></i><b>3</b> Enrichment anaysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html#enrichment-for-non-model-organisms"><i class="fa fa-check"></i><b>3.1</b> Enrichment for non-model organisms</a></li>
<li class="chapter" data-level="3.2" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html#own-enrichment-data"><i class="fa fa-check"></i><b>3.2</b> Own enrichment data</a></li>
<li class="chapter" data-level="3.3" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html#batch-enrichment-analysis"><i class="fa fa-check"></i><b>3.3</b> Batch enrichment analysis</a></li>
<li class="chapter" data-level="3.4" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html#add-annotation-for-specific-groups"><i class="fa fa-check"></i><b>3.4</b> Add annotation for specific groups</a></li>
<li class="chapter" data-level="3.5" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html#add-barplot-for-enrichment-annotation"><i class="fa fa-check"></i><b>3.5</b> Add barplot for enrichment annotation</a></li>
<li class="chapter" data-level="3.6" data-path="enrichment-anaysis.html"><a href="enrichment-anaysis.html#add-kegg-annotation"><i class="fa fa-check"></i><b>3.6</b> Add KEGG annotation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="parse-wgcna-output.html"><a href="parse-wgcna-output.html"><i class="fa fa-check"></i><b>4</b> Parse WGCNA output</a></li>
<li class="chapter" data-level="5" data-path="parse-single-cell-data.html"><a href="parse-single-cell-data.html"><i class="fa fa-check"></i><b>5</b> Parse single cell data</a></li>
<li class="chapter" data-level="6" data-path="parse-preudotime-data.html"><a href="parse-preudotime-data.html"><i class="fa fa-check"></i><b>6</b> Parse preudotime data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="parse-preudotime-data.html"><a href="parse-preudotime-data.html#monocle2-implemention"><i class="fa fa-check"></i><b>6.1</b> Monocle2 implemention</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="parse-preudotime-data.html"><a href="parse-preudotime-data.html#plot_pseudotime_heatmap2"><i class="fa fa-check"></i><b>6.1.1</b> plot_pseudotime_heatmap2</a></li>
<li class="chapter" data-level="6.1.2" data-path="parse-preudotime-data.html"><a href="parse-preudotime-data.html#plot_genes_branched_heatmap2"><i class="fa fa-check"></i><b>6.1.2</b> plot_genes_branched_heatmap2</a></li>
<li class="chapter" data-level="6.1.3" data-path="parse-preudotime-data.html"><a href="parse-preudotime-data.html#plot_multiple_branches_heatmap2"><i class="fa fa-check"></i><b>6.1.3</b> plot_multiple_branches_heatmap2</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="parse-preudotime-data.html"><a href="parse-preudotime-data.html#monocle3-implemention"><i class="fa fa-check"></i><b>6.2</b> Monocle3 implemention</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="add-custom-annotation.html"><a href="add-custom-annotation.html"><i class="fa fa-check"></i><b>7</b> Add custom annotation</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ClusterGVis Reference Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="add-custom-annotation" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Add custom annotation<a href="add-custom-annotation.html#add-custom-annotation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>I was thinking that <strong>ClusterGVis</strong> has some limitations when adding annotations to heatmaps. It would be better if we could customize and add relevant plots to each cluster, rather than being restricted to the data within the heatmap. So, you simply need to create the plot (<strong>using ggplot2</strong>), and then insert it into the relevant cluster, not limiting it to the heatmap data.</p>
<p>For example, when displaying marker genes in single-cell analysis, you could insert a feature plot (<strong>scatterplot</strong>) of the marker genes on the right side. Of course, any other kind of plot could also be used.</p>
<p>Additionally, I’ve added a new <strong>gglist</strong> parameter to ClusterGVis. You just need to provide a list of ggplot objects, making sure that the order corresponds correctly.</p>
<p>Create a scatter plot for marker genes for each celtype:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="add-custom-annotation.html#cb76-1" tabindex="-1"></a><span class="co"># find markers for every cluster compared to all remaining cells</span></span>
<span id="cb76-2"><a href="add-custom-annotation.html#cb76-2" tabindex="-1"></a><span class="co"># report only the positive ones</span></span>
<span id="cb76-3"><a href="add-custom-annotation.html#cb76-3" tabindex="-1"></a>pbmc.markers.all <span class="ot">&lt;-</span> Seurat<span class="sc">::</span><span class="fu">FindAllMarkers</span>(pbmc,</span>
<span id="cb76-4"><a href="add-custom-annotation.html#cb76-4" tabindex="-1"></a>                                           <span class="at">only.pos =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-5"><a href="add-custom-annotation.html#cb76-5" tabindex="-1"></a>                                           <span class="at">min.pct =</span> <span class="fl">0.25</span>,</span>
<span id="cb76-6"><a href="add-custom-annotation.html#cb76-6" tabindex="-1"></a>                                           <span class="at">logfc.threshold =</span> <span class="fl">0.25</span>)</span>
<span id="cb76-7"><a href="add-custom-annotation.html#cb76-7" tabindex="-1"></a></span>
<span id="cb76-8"><a href="add-custom-annotation.html#cb76-8" tabindex="-1"></a><span class="co"># get top 10 genes</span></span>
<span id="cb76-9"><a href="add-custom-annotation.html#cb76-9" tabindex="-1"></a>pbmc.markers <span class="ot">&lt;-</span> pbmc.markers.all <span class="sc">%&gt;%</span></span>
<span id="cb76-10"><a href="add-custom-annotation.html#cb76-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb76-11"><a href="add-custom-annotation.html#cb76-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">top_n</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">wt =</span> avg_log2FC)</span>
<span id="cb76-12"><a href="add-custom-annotation.html#cb76-12" tabindex="-1"></a></span>
<span id="cb76-13"><a href="add-custom-annotation.html#cb76-13" tabindex="-1"></a><span class="co"># prepare data from seurat object</span></span>
<span id="cb76-14"><a href="add-custom-annotation.html#cb76-14" tabindex="-1"></a>st.data <span class="ot">&lt;-</span> <span class="fu">prepareDataFromscRNA</span>(<span class="at">object =</span> pbmc,</span>
<span id="cb76-15"><a href="add-custom-annotation.html#cb76-15" tabindex="-1"></a>                                <span class="at">diffData =</span> pbmc.markers,</span>
<span id="cb76-16"><a href="add-custom-annotation.html#cb76-16" tabindex="-1"></a>                                <span class="at">showAverage =</span> <span class="cn">TRUE</span>)</span>
<span id="cb76-17"><a href="add-custom-annotation.html#cb76-17" tabindex="-1"></a></span>
<span id="cb76-18"><a href="add-custom-annotation.html#cb76-18" tabindex="-1"></a><span class="co"># loop plot</span></span>
<span id="cb76-19"><a href="add-custom-annotation.html#cb76-19" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">unique</span>(pbmc.markers<span class="sc">$</span>cluster), <span class="cf">function</span>(x){</span>
<span id="cb76-20"><a href="add-custom-annotation.html#cb76-20" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> pbmc.markers <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(cluster <span class="sc">==</span> x)</span>
<span id="cb76-21"><a href="add-custom-annotation.html#cb76-21" tabindex="-1"></a>  </span>
<span id="cb76-22"><a href="add-custom-annotation.html#cb76-22" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb76-23"><a href="add-custom-annotation.html#cb76-23" tabindex="-1"></a>  p <span class="ot">&lt;-</span> Seurat<span class="sc">::</span><span class="fu">FeaturePlot</span>(<span class="at">object =</span> pbmc,</span>
<span id="cb76-24"><a href="add-custom-annotation.html#cb76-24" tabindex="-1"></a>                           <span class="at">features =</span> tmp<span class="sc">$</span>gene,</span>
<span id="cb76-25"><a href="add-custom-annotation.html#cb76-25" tabindex="-1"></a>                           <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb76-26"><a href="add-custom-annotation.html#cb76-26" tabindex="-1"></a>  </span>
<span id="cb76-27"><a href="add-custom-annotation.html#cb76-27" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb76-28"><a href="add-custom-annotation.html#cb76-28" tabindex="-1"></a>}) <span class="ot">-&gt;</span> gglist</span>
<span id="cb76-29"><a href="add-custom-annotation.html#cb76-29" tabindex="-1"></a></span>
<span id="cb76-30"><a href="add-custom-annotation.html#cb76-30" tabindex="-1"></a><span class="co"># assign names</span></span>
<span id="cb76-31"><a href="add-custom-annotation.html#cb76-31" tabindex="-1"></a><span class="fu">names</span>(gglist) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;C&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p align="center">
<img src="local_images/46.png" width="80%">
</p>
<p>Insert scatter plot:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="add-custom-annotation.html#cb77-1" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&#39;sc_ggplot.pdf&#39;</span>,<span class="at">height =</span> <span class="dv">16</span>,<span class="at">width =</span> <span class="dv">18</span>,<span class="at">onefile =</span> F)</span>
<span id="cb77-2"><a href="add-custom-annotation.html#cb77-2" tabindex="-1"></a><span class="fu">visCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb77-3"><a href="add-custom-annotation.html#cb77-3" tabindex="-1"></a>           <span class="at">plot.type =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb77-4"><a href="add-custom-annotation.html#cb77-4" tabindex="-1"></a>           <span class="at">line.side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb77-5"><a href="add-custom-annotation.html#cb77-5" tabindex="-1"></a>           <span class="at">column_names_rot =</span> <span class="dv">45</span>,</span>
<span id="cb77-6"><a href="add-custom-annotation.html#cb77-6" tabindex="-1"></a>           <span class="at">markGenes =</span> pbmc.markers<span class="sc">$</span>gene,</span>
<span id="cb77-7"><a href="add-custom-annotation.html#cb77-7" tabindex="-1"></a>           <span class="at">cluster.order =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb77-8"><a href="add-custom-annotation.html#cb77-8" tabindex="-1"></a>           <span class="at">ggplot.panel.arg =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">24</span>,<span class="st">&quot;grey90&quot;</span>,<span class="cn">NA</span>),</span>
<span id="cb77-9"><a href="add-custom-annotation.html#cb77-9" tabindex="-1"></a>           <span class="at">gglist =</span> gglist)</span>
<span id="cb77-10"><a href="add-custom-annotation.html#cb77-10" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p align="center">
<img src="local_images/47.png" width="80%">
</p>
<p>Use <strong>scRNAtoolVis</strong> to generate scatter plot:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="add-custom-annotation.html#cb78-1" tabindex="-1"></a><span class="fu">library</span>(scRNAtoolVis)</span>
<span id="cb78-2"><a href="add-custom-annotation.html#cb78-2" tabindex="-1"></a></span>
<span id="cb78-3"><a href="add-custom-annotation.html#cb78-3" tabindex="-1"></a><span class="co"># loop plot</span></span>
<span id="cb78-4"><a href="add-custom-annotation.html#cb78-4" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">unique</span>(pbmc.markers<span class="sc">$</span>cluster), <span class="cf">function</span>(x){</span>
<span id="cb78-5"><a href="add-custom-annotation.html#cb78-5" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> pbmc.markers <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(cluster <span class="sc">==</span> x)</span>
<span id="cb78-6"><a href="add-custom-annotation.html#cb78-6" tabindex="-1"></a>  </span>
<span id="cb78-7"><a href="add-custom-annotation.html#cb78-7" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb78-8"><a href="add-custom-annotation.html#cb78-8" tabindex="-1"></a>  p <span class="ot">&lt;-</span></span>
<span id="cb78-9"><a href="add-custom-annotation.html#cb78-9" tabindex="-1"></a>    <span class="fu">featureCornerAxes</span>(<span class="at">object =</span> pbmc,</span>
<span id="cb78-10"><a href="add-custom-annotation.html#cb78-10" tabindex="-1"></a>                      <span class="at">reduction =</span> <span class="st">&#39;umap&#39;</span>,</span>
<span id="cb78-11"><a href="add-custom-annotation.html#cb78-11" tabindex="-1"></a>                      <span class="at">groupFacet =</span> <span class="cn">NULL</span>,</span>
<span id="cb78-12"><a href="add-custom-annotation.html#cb78-12" tabindex="-1"></a>                      <span class="at">relLength =</span> <span class="fl">0.65</span>,</span>
<span id="cb78-13"><a href="add-custom-annotation.html#cb78-13" tabindex="-1"></a>                      <span class="at">relDist =</span> <span class="fl">0.2</span>,</span>
<span id="cb78-14"><a href="add-custom-annotation.html#cb78-14" tabindex="-1"></a>                      <span class="at">cornerTextSize =</span> <span class="fl">2.5</span>,</span>
<span id="cb78-15"><a href="add-custom-annotation.html#cb78-15" tabindex="-1"></a>                      <span class="at">features =</span> tmp<span class="sc">$</span>gene,</span>
<span id="cb78-16"><a href="add-custom-annotation.html#cb78-16" tabindex="-1"></a>                      <span class="at">show.legend =</span> F)</span>
<span id="cb78-17"><a href="add-custom-annotation.html#cb78-17" tabindex="-1"></a>  </span>
<span id="cb78-18"><a href="add-custom-annotation.html#cb78-18" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb78-19"><a href="add-custom-annotation.html#cb78-19" tabindex="-1"></a>}) <span class="ot">-&gt;</span> gglist</span>
<span id="cb78-20"><a href="add-custom-annotation.html#cb78-20" tabindex="-1"></a></span>
<span id="cb78-21"><a href="add-custom-annotation.html#cb78-21" tabindex="-1"></a><span class="co"># assign names</span></span>
<span id="cb78-22"><a href="add-custom-annotation.html#cb78-22" tabindex="-1"></a><span class="fu">names</span>(gglist) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;C&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb78-23"><a href="add-custom-annotation.html#cb78-23" tabindex="-1"></a></span>
<span id="cb78-24"><a href="add-custom-annotation.html#cb78-24" tabindex="-1"></a><span class="co"># insert scatter plot</span></span>
<span id="cb78-25"><a href="add-custom-annotation.html#cb78-25" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&#39;sc_ggplot_scRNAtoolVis.pdf&#39;</span>,<span class="at">height =</span> <span class="dv">16</span>,<span class="at">width =</span> <span class="dv">16</span>,<span class="at">onefile =</span> F)</span>
<span id="cb78-26"><a href="add-custom-annotation.html#cb78-26" tabindex="-1"></a><span class="fu">visCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb78-27"><a href="add-custom-annotation.html#cb78-27" tabindex="-1"></a>           <span class="at">plot.type =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb78-28"><a href="add-custom-annotation.html#cb78-28" tabindex="-1"></a>           <span class="at">line.side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb78-29"><a href="add-custom-annotation.html#cb78-29" tabindex="-1"></a>           <span class="at">column_names_rot =</span> <span class="dv">45</span>,</span>
<span id="cb78-30"><a href="add-custom-annotation.html#cb78-30" tabindex="-1"></a>           <span class="at">markGenes =</span> pbmc.markers<span class="sc">$</span>gene,</span>
<span id="cb78-31"><a href="add-custom-annotation.html#cb78-31" tabindex="-1"></a>           <span class="at">cluster.order =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb78-32"><a href="add-custom-annotation.html#cb78-32" tabindex="-1"></a>           <span class="at">ggplot.panel.arg =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">13</span>,<span class="st">&quot;grey90&quot;</span>,<span class="cn">NA</span>),</span>
<span id="cb78-33"><a href="add-custom-annotation.html#cb78-33" tabindex="-1"></a>           <span class="at">gglist =</span> gglist)</span>
<span id="cb78-34"><a href="add-custom-annotation.html#cb78-34" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p align="center">
<img src="local_images/48.png" width="80%">
</p>
<p>Add custom enrichment plot:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="add-custom-annotation.html#cb79-1" tabindex="-1"></a><span class="co"># enrich for clusters</span></span>
<span id="cb79-2"><a href="add-custom-annotation.html#cb79-2" tabindex="-1"></a>enrich <span class="ot">&lt;-</span> <span class="fu">enrichCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb79-3"><a href="add-custom-annotation.html#cb79-3" tabindex="-1"></a>                        <span class="at">OrgDb =</span> org.Hs.eg.db,</span>
<span id="cb79-4"><a href="add-custom-annotation.html#cb79-4" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;BP&quot;</span>,</span>
<span id="cb79-5"><a href="add-custom-annotation.html#cb79-5" tabindex="-1"></a>                        <span class="at">organism =</span> <span class="st">&quot;hsa&quot;</span>,</span>
<span id="cb79-6"><a href="add-custom-annotation.html#cb79-6" tabindex="-1"></a>                        <span class="at">pvalueCutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb79-7"><a href="add-custom-annotation.html#cb79-7" tabindex="-1"></a>                        <span class="at">topn =</span> <span class="dv">5</span>,</span>
<span id="cb79-8"><a href="add-custom-annotation.html#cb79-8" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">5201314</span>)</span>
<span id="cb79-9"><a href="add-custom-annotation.html#cb79-9" tabindex="-1"></a></span>
<span id="cb79-10"><a href="add-custom-annotation.html#cb79-10" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb79-11"><a href="add-custom-annotation.html#cb79-11" tabindex="-1"></a><span class="fu">head</span>(enrich,<span class="dv">3</span>)</span>
<span id="cb79-12"><a href="add-custom-annotation.html#cb79-12" tabindex="-1"></a><span class="co">#            group                                         Description       pvalue    ratio</span></span>
<span id="cb79-13"><a href="add-custom-annotation.html#cb79-13" tabindex="-1"></a><span class="co"># GO:0002573    C1                   myeloid leukocyte differentiation 0.0003941646 66.66667</span></span>
<span id="cb79-14"><a href="add-custom-annotation.html#cb79-14" tabindex="-1"></a><span class="co"># GO:0050870    C1            positive regulation of T cell activation 0.0005222343 66.66667</span></span>
<span id="cb79-15"><a href="add-custom-annotation.html#cb79-15" tabindex="-1"></a><span class="co"># GO:1903039    C1 positive regulation of leukocyte cell-cell adhesion 0.0006265618 66.66667</span></span>
<span id="cb79-16"><a href="add-custom-annotation.html#cb79-16" tabindex="-1"></a></span>
<span id="cb79-17"><a href="add-custom-annotation.html#cb79-17" tabindex="-1"></a><span class="co"># barplot</span></span>
<span id="cb79-18"><a href="add-custom-annotation.html#cb79-18" tabindex="-1"></a>palette <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Grays&quot;</span>,<span class="st">&quot;Light Grays&quot;</span>,<span class="st">&quot;Blues2&quot;</span>,<span class="st">&quot;Blues3&quot;</span>,<span class="st">&quot;Purples2&quot;</span>,<span class="st">&quot;Purples3&quot;</span>,<span class="st">&quot;Reds2&quot;</span>,<span class="st">&quot;Reds3&quot;</span>,<span class="st">&quot;Greens2&quot;</span>)</span>
<span id="cb79-19"><a href="add-custom-annotation.html#cb79-19" tabindex="-1"></a></span>
<span id="cb79-20"><a href="add-custom-annotation.html#cb79-20" tabindex="-1"></a><span class="co"># loop</span></span>
<span id="cb79-21"><a href="add-custom-annotation.html#cb79-21" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">seq_along</span>(<span class="fu">unique</span>(enrich<span class="sc">$</span>group)), <span class="cf">function</span>(x){</span>
<span id="cb79-22"><a href="add-custom-annotation.html#cb79-22" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> enrich <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="fu">unique</span>(enrich<span class="sc">$</span>group)[x]) <span class="sc">|&gt;</span></span>
<span id="cb79-23"><a href="add-custom-annotation.html#cb79-23" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(pvalue))</span>
<span id="cb79-24"><a href="add-custom-annotation.html#cb79-24" tabindex="-1"></a>  </span>
<span id="cb79-25"><a href="add-custom-annotation.html#cb79-25" tabindex="-1"></a>  tmp<span class="sc">$</span>Description <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp<span class="sc">$</span>Description,<span class="at">levels =</span> tmp<span class="sc">$</span>Description)</span>
<span id="cb79-26"><a href="add-custom-annotation.html#cb79-26" tabindex="-1"></a>  </span>
<span id="cb79-27"><a href="add-custom-annotation.html#cb79-27" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb79-28"><a href="add-custom-annotation.html#cb79-28" tabindex="-1"></a>  p <span class="ot">&lt;-</span></span>
<span id="cb79-29"><a href="add-custom-annotation.html#cb79-29" tabindex="-1"></a>    <span class="fu">ggplot</span>(tmp) <span class="sc">+</span></span>
<span id="cb79-30"><a href="add-custom-annotation.html#cb79-30" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue),<span class="at">y =</span> Description,<span class="at">fill =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue)),</span>
<span id="cb79-31"><a href="add-custom-annotation.html#cb79-31" tabindex="-1"></a>             <span class="at">width =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb79-32"><a href="add-custom-annotation.html#cb79-32" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(ratio),<span class="at">y =</span> <span class="fu">as.numeric</span>(Description)),<span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-33"><a href="add-custom-annotation.html#cb79-33" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(ratio),<span class="at">y =</span> Description),<span class="at">size =</span> <span class="dv">3</span>,<span class="at">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-34"><a href="add-custom-annotation.html#cb79-34" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb79-35"><a href="add-custom-annotation.html#cb79-35" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb79-36"><a href="add-custom-annotation.html#cb79-36" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x) stringr<span class="sc">::</span><span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb79-37"><a href="add-custom-annotation.html#cb79-37" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.,<span class="at">name =</span> <span class="st">&quot;log10(ratio)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb79-38"><a href="add-custom-annotation.html#cb79-38" tabindex="-1"></a>    colorspace<span class="sc">::</span><span class="fu">scale_fill_binned_sequential</span>(<span class="at">palette =</span> palette[x]) <span class="sc">+</span></span>
<span id="cb79-39"><a href="add-custom-annotation.html#cb79-39" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb79-40"><a href="add-custom-annotation.html#cb79-40" tabindex="-1"></a>  </span>
<span id="cb79-41"><a href="add-custom-annotation.html#cb79-41" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb79-42"><a href="add-custom-annotation.html#cb79-42" tabindex="-1"></a>}) <span class="ot">-&gt;</span> gglist</span>
<span id="cb79-43"><a href="add-custom-annotation.html#cb79-43" tabindex="-1"></a></span>
<span id="cb79-44"><a href="add-custom-annotation.html#cb79-44" tabindex="-1"></a><span class="co"># assign names</span></span>
<span id="cb79-45"><a href="add-custom-annotation.html#cb79-45" tabindex="-1"></a><span class="fu">names</span>(gglist) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;C&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb79-46"><a href="add-custom-annotation.html#cb79-46" tabindex="-1"></a></span>
<span id="cb79-47"><a href="add-custom-annotation.html#cb79-47" tabindex="-1"></a><span class="co"># insert bar plot</span></span>
<span id="cb79-48"><a href="add-custom-annotation.html#cb79-48" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&#39;sc_ggplot_go.pdf&#39;</span>,<span class="at">height =</span> <span class="dv">20</span>,<span class="at">width =</span> <span class="dv">16</span>,<span class="at">onefile =</span> F)</span>
<span id="cb79-49"><a href="add-custom-annotation.html#cb79-49" tabindex="-1"></a><span class="fu">visCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb79-50"><a href="add-custom-annotation.html#cb79-50" tabindex="-1"></a>           <span class="at">plot.type =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb79-51"><a href="add-custom-annotation.html#cb79-51" tabindex="-1"></a>           <span class="at">line.side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb79-52"><a href="add-custom-annotation.html#cb79-52" tabindex="-1"></a>           <span class="at">column_names_rot =</span> <span class="dv">45</span>,</span>
<span id="cb79-53"><a href="add-custom-annotation.html#cb79-53" tabindex="-1"></a>           <span class="at">markGenes =</span> pbmc.markers<span class="sc">$</span>gene,</span>
<span id="cb79-54"><a href="add-custom-annotation.html#cb79-54" tabindex="-1"></a>           <span class="at">cluster.order =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb79-55"><a href="add-custom-annotation.html#cb79-55" tabindex="-1"></a>           <span class="at">ggplot.panel.arg =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="fl">0.5</span>,<span class="dv">16</span>,<span class="st">&quot;grey90&quot;</span>,<span class="cn">NA</span>),</span>
<span id="cb79-56"><a href="add-custom-annotation.html#cb79-56" tabindex="-1"></a>           <span class="at">gglist =</span> gglist)</span>
<span id="cb79-57"><a href="add-custom-annotation.html#cb79-57" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p align="center">
<img src="local_images/49.png" width="80%">
</p>
<p>Add GO and KEGG enrichment annotation:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="add-custom-annotation.html#cb80-1" tabindex="-1"></a><span class="co"># enrich for clusters</span></span>
<span id="cb80-2"><a href="add-custom-annotation.html#cb80-2" tabindex="-1"></a>enrich <span class="ot">&lt;-</span> <span class="fu">enrichCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb80-3"><a href="add-custom-annotation.html#cb80-3" tabindex="-1"></a>                        <span class="at">OrgDb =</span> org.Hs.eg.db,</span>
<span id="cb80-4"><a href="add-custom-annotation.html#cb80-4" tabindex="-1"></a>                        <span class="at">type =</span> <span class="st">&quot;BP&quot;</span>,</span>
<span id="cb80-5"><a href="add-custom-annotation.html#cb80-5" tabindex="-1"></a>                        <span class="at">organism =</span> <span class="st">&quot;hsa&quot;</span>,</span>
<span id="cb80-6"><a href="add-custom-annotation.html#cb80-6" tabindex="-1"></a>                        <span class="at">pvalueCutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb80-7"><a href="add-custom-annotation.html#cb80-7" tabindex="-1"></a>                        <span class="at">topn =</span> <span class="dv">5</span>,</span>
<span id="cb80-8"><a href="add-custom-annotation.html#cb80-8" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">5201314</span>)</span>
<span id="cb80-9"><a href="add-custom-annotation.html#cb80-9" tabindex="-1"></a></span>
<span id="cb80-10"><a href="add-custom-annotation.html#cb80-10" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb80-11"><a href="add-custom-annotation.html#cb80-11" tabindex="-1"></a><span class="fu">head</span>(enrich,<span class="dv">3</span>)</span>
<span id="cb80-12"><a href="add-custom-annotation.html#cb80-12" tabindex="-1"></a><span class="co">#            group                                         Description       pvalue    ratio</span></span>
<span id="cb80-13"><a href="add-custom-annotation.html#cb80-13" tabindex="-1"></a><span class="co"># GO:0002573    C1                   myeloid leukocyte differentiation 0.0003941646 66.66667</span></span>
<span id="cb80-14"><a href="add-custom-annotation.html#cb80-14" tabindex="-1"></a><span class="co"># GO:0050870    C1            positive regulation of T cell activation 0.0005222343 66.66667</span></span>
<span id="cb80-15"><a href="add-custom-annotation.html#cb80-15" tabindex="-1"></a><span class="co"># GO:1903039    C1 positive regulation of leukocyte cell-cell adhesion 0.0006265618 66.66667</span></span>
<span id="cb80-16"><a href="add-custom-annotation.html#cb80-16" tabindex="-1"></a></span>
<span id="cb80-17"><a href="add-custom-annotation.html#cb80-17" tabindex="-1"></a>enrich.KEGG <span class="ot">&lt;-</span> <span class="fu">enrichCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb80-18"><a href="add-custom-annotation.html#cb80-18" tabindex="-1"></a>                             <span class="at">OrgDb =</span> org.Hs.eg.db,</span>
<span id="cb80-19"><a href="add-custom-annotation.html#cb80-19" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">&quot;KEGG&quot;</span>,</span>
<span id="cb80-20"><a href="add-custom-annotation.html#cb80-20" tabindex="-1"></a>                             <span class="at">organism =</span> <span class="st">&quot;hsa&quot;</span>,</span>
<span id="cb80-21"><a href="add-custom-annotation.html#cb80-21" tabindex="-1"></a>                             <span class="at">pvalueCutoff =</span> <span class="fl">0.9</span>,</span>
<span id="cb80-22"><a href="add-custom-annotation.html#cb80-22" tabindex="-1"></a>                             <span class="at">topn =</span> <span class="dv">5</span>,</span>
<span id="cb80-23"><a href="add-custom-annotation.html#cb80-23" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">5201314</span>)</span>
<span id="cb80-24"><a href="add-custom-annotation.html#cb80-24" tabindex="-1"></a></span>
<span id="cb80-25"><a href="add-custom-annotation.html#cb80-25" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb80-26"><a href="add-custom-annotation.html#cb80-26" tabindex="-1"></a><span class="fu">head</span>(enrich.KEGG,<span class="dv">3</span>)</span>
<span id="cb80-27"><a href="add-custom-annotation.html#cb80-27" tabindex="-1"></a><span class="co">#          group           Description     pvalue    ratio</span></span>
<span id="cb80-28"><a href="add-custom-annotation.html#cb80-28" tabindex="-1"></a><span class="co"># hsa00640    C1 Propanoate metabolism 0.01115231 33.33333</span></span>
<span id="cb80-29"><a href="add-custom-annotation.html#cb80-29" tabindex="-1"></a><span class="co"># hsa05216    C1        Thyroid cancer 0.01288734 33.33333</span></span>
<span id="cb80-30"><a href="add-custom-annotation.html#cb80-30" tabindex="-1"></a><span class="co"># hsa00620    C1   Pyruvate metabolism 0.01635129 33.33333</span></span>
<span id="cb80-31"><a href="add-custom-annotation.html#cb80-31" tabindex="-1"></a></span>
<span id="cb80-32"><a href="add-custom-annotation.html#cb80-32" tabindex="-1"></a>palette <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Grays&quot;</span>,<span class="st">&quot;Light Grays&quot;</span>,<span class="st">&quot;Blues2&quot;</span>,<span class="st">&quot;Blues3&quot;</span>,<span class="st">&quot;Purples2&quot;</span>,<span class="st">&quot;Purples3&quot;</span>,<span class="st">&quot;Reds2&quot;</span>,<span class="st">&quot;Reds3&quot;</span>,<span class="st">&quot;Greens2&quot;</span>)</span>
<span id="cb80-33"><a href="add-custom-annotation.html#cb80-33" tabindex="-1"></a></span>
<span id="cb80-34"><a href="add-custom-annotation.html#cb80-34" tabindex="-1"></a><span class="co"># loop</span></span>
<span id="cb80-35"><a href="add-custom-annotation.html#cb80-35" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">seq_along</span>(<span class="fu">unique</span>(enrich<span class="sc">$</span>group)), <span class="cf">function</span>(x){</span>
<span id="cb80-36"><a href="add-custom-annotation.html#cb80-36" tabindex="-1"></a>  <span class="co"># go plot</span></span>
<span id="cb80-37"><a href="add-custom-annotation.html#cb80-37" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> enrich <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="fu">unique</span>(enrich<span class="sc">$</span>group)[x]) <span class="sc">|&gt;</span></span>
<span id="cb80-38"><a href="add-custom-annotation.html#cb80-38" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(pvalue))</span>
<span id="cb80-39"><a href="add-custom-annotation.html#cb80-39" tabindex="-1"></a>  </span>
<span id="cb80-40"><a href="add-custom-annotation.html#cb80-40" tabindex="-1"></a>  tmp<span class="sc">$</span>Description <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp<span class="sc">$</span>Description,<span class="at">levels =</span> tmp<span class="sc">$</span>Description)</span>
<span id="cb80-41"><a href="add-custom-annotation.html#cb80-41" tabindex="-1"></a>  </span>
<span id="cb80-42"><a href="add-custom-annotation.html#cb80-42" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb80-43"><a href="add-custom-annotation.html#cb80-43" tabindex="-1"></a>  p <span class="ot">&lt;-</span></span>
<span id="cb80-44"><a href="add-custom-annotation.html#cb80-44" tabindex="-1"></a>    <span class="fu">ggplot</span>(tmp) <span class="sc">+</span></span>
<span id="cb80-45"><a href="add-custom-annotation.html#cb80-45" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue),<span class="at">y =</span> Description,<span class="at">fill =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue)),</span>
<span id="cb80-46"><a href="add-custom-annotation.html#cb80-46" tabindex="-1"></a>             <span class="at">width =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb80-47"><a href="add-custom-annotation.html#cb80-47" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(ratio),<span class="at">y =</span> <span class="fu">as.numeric</span>(Description)),<span class="at">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-48"><a href="add-custom-annotation.html#cb80-48" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log10</span>(ratio),<span class="at">y =</span> Description),<span class="at">size =</span> <span class="dv">3</span>,<span class="at">color =</span> <span class="st">&quot;orange&quot;</span>) <span class="sc">+</span></span>
<span id="cb80-49"><a href="add-custom-annotation.html#cb80-49" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb80-50"><a href="add-custom-annotation.html#cb80-50" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb80-51"><a href="add-custom-annotation.html#cb80-51" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x) stringr<span class="sc">::</span><span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb80-52"><a href="add-custom-annotation.html#cb80-52" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.,<span class="at">name =</span> <span class="st">&quot;log10(ratio)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb80-53"><a href="add-custom-annotation.html#cb80-53" tabindex="-1"></a>    colorspace<span class="sc">::</span><span class="fu">scale_fill_binned_sequential</span>(<span class="at">palette =</span> palette[x]) <span class="sc">+</span></span>
<span id="cb80-54"><a href="add-custom-annotation.html#cb80-54" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb80-55"><a href="add-custom-annotation.html#cb80-55" tabindex="-1"></a>  </span>
<span id="cb80-56"><a href="add-custom-annotation.html#cb80-56" tabindex="-1"></a>  <span class="co"># plot kegg</span></span>
<span id="cb80-57"><a href="add-custom-annotation.html#cb80-57" tabindex="-1"></a>  tmp.kg <span class="ot">&lt;-</span> enrich.KEGG <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> <span class="fu">unique</span>(enrich.KEGG<span class="sc">$</span>group)[x]) <span class="sc">|&gt;</span></span>
<span id="cb80-58"><a href="add-custom-annotation.html#cb80-58" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(pvalue))</span>
<span id="cb80-59"><a href="add-custom-annotation.html#cb80-59" tabindex="-1"></a>  </span>
<span id="cb80-60"><a href="add-custom-annotation.html#cb80-60" tabindex="-1"></a>  tmp.kg<span class="sc">$</span>Description <span class="ot">&lt;-</span> <span class="fu">factor</span>(tmp.kg<span class="sc">$</span>Description,<span class="at">levels =</span> tmp.kg<span class="sc">$</span>Description)</span>
<span id="cb80-61"><a href="add-custom-annotation.html#cb80-61" tabindex="-1"></a>  </span>
<span id="cb80-62"><a href="add-custom-annotation.html#cb80-62" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb80-63"><a href="add-custom-annotation.html#cb80-63" tabindex="-1"></a>  pk <span class="ot">&lt;-</span></span>
<span id="cb80-64"><a href="add-custom-annotation.html#cb80-64" tabindex="-1"></a>    <span class="fu">ggplot</span>(tmp.kg) <span class="sc">+</span></span>
<span id="cb80-65"><a href="add-custom-annotation.html#cb80-65" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>,<span class="at">xend =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue),<span class="at">y =</span> Description,<span class="at">yend =</span> Description),</span>
<span id="cb80-66"><a href="add-custom-annotation.html#cb80-66" tabindex="-1"></a>                 <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>,<span class="at">linewidth =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb80-67"><a href="add-custom-annotation.html#cb80-67" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue),<span class="at">y =</span> Description,<span class="at">color =</span> <span class="sc">-</span><span class="fu">log10</span>(pvalue)),<span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb80-68"><a href="add-custom-annotation.html#cb80-68" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb80-69"><a href="add-custom-annotation.html#cb80-69" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb80-70"><a href="add-custom-annotation.html#cb80-70" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x) stringr<span class="sc">::</span><span class="fu">str_wrap</span>(x, <span class="at">width =</span> <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb80-71"><a href="add-custom-annotation.html#cb80-71" tabindex="-1"></a>    colorspace<span class="sc">::</span><span class="fu">scale_color_binned_sequential</span>(<span class="at">palette =</span> palette[x]) <span class="sc">+</span></span>
<span id="cb80-72"><a href="add-custom-annotation.html#cb80-72" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;-log10(pvalue)&quot;</span>)</span>
<span id="cb80-73"><a href="add-custom-annotation.html#cb80-73" tabindex="-1"></a>  </span>
<span id="cb80-74"><a href="add-custom-annotation.html#cb80-74" tabindex="-1"></a>  <span class="co"># combine</span></span>
<span id="cb80-75"><a href="add-custom-annotation.html#cb80-75" tabindex="-1"></a>  cb <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">list</span>(p,pk))</span>
<span id="cb80-76"><a href="add-custom-annotation.html#cb80-76" tabindex="-1"></a>  </span>
<span id="cb80-77"><a href="add-custom-annotation.html#cb80-77" tabindex="-1"></a>  <span class="fu">return</span>(cb)</span>
<span id="cb80-78"><a href="add-custom-annotation.html#cb80-78" tabindex="-1"></a>}) <span class="ot">-&gt;</span> gglist</span>
<span id="cb80-79"><a href="add-custom-annotation.html#cb80-79" tabindex="-1"></a></span>
<span id="cb80-80"><a href="add-custom-annotation.html#cb80-80" tabindex="-1"></a><span class="co"># assign names</span></span>
<span id="cb80-81"><a href="add-custom-annotation.html#cb80-81" tabindex="-1"></a><span class="fu">names</span>(gglist) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;C&quot;</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>,<span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb80-82"><a href="add-custom-annotation.html#cb80-82" tabindex="-1"></a></span>
<span id="cb80-83"><a href="add-custom-annotation.html#cb80-83" tabindex="-1"></a><span class="co"># insert bar plot</span></span>
<span id="cb80-84"><a href="add-custom-annotation.html#cb80-84" tabindex="-1"></a><span class="fu">pdf</span>(<span class="st">&#39;sc_ggplot_gokegg.pdf&#39;</span>,<span class="at">height =</span> <span class="dv">20</span>,<span class="at">width =</span> <span class="dv">22</span>,<span class="at">onefile =</span> F)</span>
<span id="cb80-85"><a href="add-custom-annotation.html#cb80-85" tabindex="-1"></a><span class="fu">visCluster</span>(<span class="at">object =</span> st.data,</span>
<span id="cb80-86"><a href="add-custom-annotation.html#cb80-86" tabindex="-1"></a>           <span class="at">plot.type =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb80-87"><a href="add-custom-annotation.html#cb80-87" tabindex="-1"></a>           <span class="at">line.side =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb80-88"><a href="add-custom-annotation.html#cb80-88" tabindex="-1"></a>           <span class="at">column_names_rot =</span> <span class="dv">45</span>,</span>
<span id="cb80-89"><a href="add-custom-annotation.html#cb80-89" tabindex="-1"></a>           <span class="at">markGenes =</span> pbmc.markers<span class="sc">$</span>gene,</span>
<span id="cb80-90"><a href="add-custom-annotation.html#cb80-90" tabindex="-1"></a>           <span class="at">cluster.order =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb80-91"><a href="add-custom-annotation.html#cb80-91" tabindex="-1"></a>           <span class="at">ggplot.panel.arg =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="fl">0.5</span>,<span class="dv">32</span>,<span class="st">&quot;grey90&quot;</span>,<span class="cn">NA</span>),</span>
<span id="cb80-92"><a href="add-custom-annotation.html#cb80-92" tabindex="-1"></a>           <span class="at">gglist =</span> gglist)</span>
<span id="cb80-93"><a href="add-custom-annotation.html#cb80-93" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<p align="center">
<img src="local_images/50.png" width="80%">
</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="parse-preudotime-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/06-add_custom_annotation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
